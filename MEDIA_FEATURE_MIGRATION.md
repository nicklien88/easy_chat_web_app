# åœ–ç‰‡å’Œå½±ç‰‡å‚³é€åŠŸèƒ½ - é·ç§»æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°
æ–°å¢äº†åœ¨èŠå¤©å®¤å‚³é€åœ–ç‰‡å’Œå½±ç‰‡çš„åŠŸèƒ½ã€‚

## è³‡æ–™åº«è®Šæ›´

éœ€è¦ä¿®æ”¹ `messages` è¡¨ä»¥æ”¯æ´æ–°çš„æ¬„ä½ï¼š

```sql
-- ä¿®æ”¹ message_type æ¬„ä½æ”¯æ´ 'video' é¡å‹
ALTER TABLE messages MODIFY COLUMN message_type ENUM('text', 'image', 'video', 'file') DEFAULT 'text';

-- æ–°å¢æª”æ¡ˆç›¸é—œæ¬„ä½
ALTER TABLE messages ADD COLUMN file_url VARCHAR(500) AFTER message_type;
ALTER TABLE messages ADD COLUMN file_name VARCHAR(255) AFTER file_url;
ALTER TABLE messages ADD COLUMN file_size BIGINT AFTER file_name;
```

## å¾Œç«¯è®Šæ›´

### 1. æ¨¡å‹ (models/message.go)
- âœ… æ–°å¢ `FileURL`, `FileName`, `FileSize` æ¬„ä½
- âœ… æ›´æ–° `MessageResponse` çµæ§‹åŒ…å«æª”æ¡ˆè³‡è¨Š
- âœ… è¨Šæ¯é¡å‹æ”¯æ´ `text`, `image`, `video`, `file`

### 2. æ§åˆ¶å™¨ (controllers/chat_controller.go)
- âœ… æ–°å¢ `UploadFile` å‡½æ•¸è™•ç†æª”æ¡ˆä¸Šå‚³
- âœ… ä¿®æ”¹ `SendMessage` æ”¯æ´å‚³é€æª”æ¡ˆè³‡è¨Š
- âœ… æª”æ¡ˆå¤§å°é™åˆ¶ï¼š50MB
- âœ… è‡ªå‹•æ ¹æ“šå‰¯æª”ååˆ¤æ–·æª”æ¡ˆé¡å‹

### 3. è·¯ç”± (routes/routes.go)
- âœ… æ–°å¢ `POST /api/chat/upload` ä¸Šå‚³æª”æ¡ˆç«¯é»
- âœ… æ–°å¢ `/uploads` éœæ…‹æª”æ¡ˆæœå‹™è·¯ç”±

### 4. æª”æ¡ˆå„²å­˜
- æª”æ¡ˆæœƒå„²å­˜åœ¨ `uploads/` ç›®éŒ„ä¸‹ï¼š
  - `uploads/images/` - åœ–ç‰‡æª”æ¡ˆ
  - `uploads/videos/` - å½±ç‰‡æª”æ¡ˆ
  - `uploads/files/` - å…¶ä»–æª”æ¡ˆ

## å‰ç«¯è®Šæ›´

### 1. API (src/api/chat.js)
- âœ… ä¿®æ”¹ `sendMessage` æ”¯æ´å‚³é€æª”æ¡ˆè³‡è¨Š
- âœ… æ–°å¢ `uploadFile` å‡½æ•¸è™•ç†æª”æ¡ˆä¸Šå‚³

### 2. èŠå¤©é é¢ (src/pages/ChatPage.jsx)
- âœ… æ–°å¢æª”æ¡ˆé¸æ“‡æŒ‰éˆ•ï¼ˆğŸ“ï¼‰
- âœ… æ–°å¢æª”æ¡ˆä¸Šå‚³è™•ç†é‚è¼¯
- âœ… åœ–ç‰‡è¨Šæ¯é¡¯ç¤ºï¼ˆå¯é»æ“Šæ”¾å¤§ï¼‰
- âœ… å½±ç‰‡è¨Šæ¯é¡¯ç¤ºï¼ˆå…§å»ºæ’­æ”¾å™¨ï¼‰
- âœ… ä¸€èˆ¬æª”æ¡ˆé¡¯ç¤ºç‚ºä¸‹è¼‰é€£çµ
- âœ… ä¸Šå‚³ä¸­ç‹€æ…‹æç¤º

## ä½¿ç”¨æ–¹å¼

### å‚³é€åœ–ç‰‡æˆ–å½±ç‰‡
1. é»æ“ŠèŠå¤©è¼¸å…¥æ¡†å·¦å´çš„ ğŸ“ æŒ‰éˆ•
2. é¸æ“‡åœ–ç‰‡æˆ–å½±ç‰‡æª”æ¡ˆï¼ˆæœ€å¤§ 50MBï¼‰
3. æª”æ¡ˆæœƒè‡ªå‹•ä¸Šå‚³ä¸¦ç™¼é€

### æ”¯æ´çš„æ ¼å¼
- **åœ–ç‰‡**: .jpg, .jpeg, .png, .gif, .webp
- **å½±ç‰‡**: .mp4, .mov, .avi, .mkv, .webm
- **å…¶ä»–**: ä»»ä½•å…¶ä»–æª”æ¡ˆé¡å‹æœƒè¢«è¦–ç‚ºä¸€èˆ¬æª”æ¡ˆ

## éƒ¨ç½²æ­¥é©Ÿ

1. **å‚™ä»½è³‡æ–™åº«**
   ```bash
   mysqldump -u root -p easy_chat > backup_before_media.sql
   ```

2. **åŸ·è¡Œè³‡æ–™åº«é·ç§»**
   ```bash
   mysql -u root -p easy_chat < migration.sql
   ```

3. **å»ºç«‹ä¸Šå‚³ç›®éŒ„**
   ```bash
   cd backend
   mkdir -p uploads/images uploads/videos uploads/files
   chmod 755 uploads
   ```

4. **æ›´æ–°å¾Œç«¯ä»£ç¢¼**
   ```bash
   cd backend
   go mod tidy
   go build
   ```

5. **æ›´æ–°å‰ç«¯ä»£ç¢¼**
   ```bash
   cd frontend
   npm install
   npm run build
   ```

6. **é‡å•Ÿæœå‹™**
   ```bash
   # å¦‚æœä½¿ç”¨ Docker
   docker-compose restart
   
   # æˆ–è€…æ‰‹å‹•é‡å•Ÿ
   # åœæ­¢ç¾æœ‰æœå‹™ä¸¦é‡æ–°å•Ÿå‹•
   ```

## ç’°å¢ƒè®Šæ•¸

å‰ç«¯éœ€è¦è¨­å®š API URLï¼ˆå¦‚æœå¾Œç«¯ä¸åœ¨åŒä¸€åŸŸåï¼‰ï¼š
```env
VITE_API_URL=http://localhost:8080
```

## å®‰å…¨æ€§è€ƒæ…®

1. **æª”æ¡ˆå¤§å°é™åˆ¶**: å·²è¨­å®šç‚º 50MB
2. **æª”æ¡ˆé¡å‹é©—è­‰**: æ ¹æ“šå‰¯æª”ååˆ¤æ–·
3. **æª”æ¡ˆå‘½å**: ä½¿ç”¨ userID + timestamp é¿å…è¡çª
4. **æ¬Šé™æª¢æŸ¥**: åªæœ‰å¥½å‹é–“å¯ä»¥å‚³é€æª”æ¡ˆ

## å¾ŒçºŒå„ªåŒ–å»ºè­°

1. **æª”æ¡ˆå£“ç¸®**: å°åœ–ç‰‡é€²è¡Œå£“ç¸®ä»¥ç¯€çœç©ºé–“
2. **é›²ç«¯å„²å­˜**: è€ƒæ…®ä½¿ç”¨ S3 æˆ–å…¶ä»–é›²ç«¯å„²å­˜æœå‹™
3. **ç¸®åœ–ç”Ÿæˆ**: ç‚ºåœ–ç‰‡ç”Ÿæˆç¸®åœ–åŠ å¿«è¼‰å…¥
4. **æª”æ¡ˆæƒæ**: å¢åŠ ç—…æ¯’æƒæåŠŸèƒ½
5. **é€²åº¦é¡¯ç¤º**: å¤§æª”æ¡ˆä¸Šå‚³æ™‚é¡¯ç¤ºé€²åº¦æ¢
6. **é è¦½åŠŸèƒ½**: ä¸Šå‚³å‰é è¦½æª”æ¡ˆ
